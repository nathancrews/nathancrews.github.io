<head>
    <meta charset="utf-8">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <script src="https://ajax.googleapis.com/ajax/libs/cesiumjs/1.105/Build/Cesium/Cesium.js"></script>
    <link href="https://ajax.googleapis.com/ajax/libs/cesiumjs/1.105/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

    <link rel="stylesheet" href="styles/nc-map.css" />
    <script src="./src/map-drop-zone.js" defer></script>
</head>

<body>
    <header id="loading-header" name="loading-header" class="map-loading">
        <h2 class="map-h2">Drag & Drop images on Map Below</h2>
        <form id="uploadForm" method="post" enctype="multipart/form-data" action="cgi-bin/ncupload.exe" target="results"
            class="map-form-input">
            <label for="directory">Enter Upload Directory Name:</label>
            <input id="directory" name="directory" value="test_drop" type="text" class="map-form-input-text">
            <label for="file" hidden="true">File(s):</label>
            <input id="file" type="file" name="file" class="map-drop-zone__input" multiple="true"
                accept=".jpg,.png,.JPG,.PNG" hidden="true">
            <button id="submit-button" name="submit-button" type="submit" hidden="true">Upload</button>
            <input id="maxFilesPerRequest" name="maxFilesPerRequest" hidden="true" value="50" />
            <input id="redirectCGI" name="redirectCGI" hidden="true"
                value="image-geo/image-mapper.js?dir=%s&response_type=json" />
            <input id="fileTypePathMap" name="fileTypePathMap" hidden="true" value="*=.jpg,.png,.JPG,.PNG" />
            <input id="basePathMap" name="basePathMap" hidden="true" value="uploads" />
        </form>
        <img id="loading-image" name="loading-image" src="images/loading.gif" class="map-form-loading-image" />
    </header>
    <div id="cesiumContainer" class="map-drop-zone map-base"></div>

    <script>
        async function LoadCesiumAssets(viewer) {
            let assetID = 2275207
            try {
                const tileset = await Cesium.Cesium3DTileset.fromIonAssetId(2275207);
                viewer.scene.primitives.add(tileset);
            } catch (error) {
                console.log(error);
            }
        }

        async function LoadCesium3D(viewer3D) {
            let retView;
            try {

                Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxYmVjM2RmMy01MTVmLTQxNTctYjk0OC1jNmM2ZTFmMzkwZDYiLCJpZCI6MTc0MzI1LCJpYXQiOjE2OTgzOTQxNjh9.qw8O6-GM1BxdYdPyUFz7MLKH3KTh52edzeS_K0EmmZQ";

                if (!viewer3D) {
                    retView = new Cesium.Viewer('cesiumContainer', {
                        imageryProvider: false,
                        baseLayerPicker: false,
                        requestRenderMode: true,
                    });
                }

                const tileset = retView.scene.primitives.add(new Cesium.Cesium3DTileset({
                    url: "https://tile.googleapis.com/v1/3dtiles/root.json?key=AIzaSyDu4Sd_RLN2sRAhS3YIDAH1WPi5dDtNbP8",
                    showCreditsOnScreen: false,
                }));

                retView.scene.globe.show = true;

            } catch (error) {
                console.log(error);
            }

            return retView;
        }

        async function LoadCesiumGeoJSON(view3D, fileURL) {

            const dataSource = await Cesium.GeoJsonDataSource.load(fileURL,
                {
                    clampToGround: true,
                    markerSize: 100
                });

            let entities = dataSource.entities.values;

            //            console.log("1 entities", entities);

            for (let i = 0; i < entities.length; i++) {
                let entity = entities[i];
                //                console.log("entity.billboard",entity.billboard);

                //                console.log('entity.properties.thumbFileName', entity.properties.thumbFileName)

                entity.billboard.scale = 0.25;
                //                entity.billboard.scaleByDistance = true;

                entity.billboard.image = entity.properties.thumbFileName;

                // entity.point = new Cesium.PointGraphics({
                //     color: Cesium.Color.fromRandom(),
                //     pixelSize: 100
                // });

                // console.log("entity.position", entity.position);
            }

            //            console.log("2 dataSource.entities", entities);

            view3D.dataSources.add(dataSource);
            view3D.zoomTo(dataSource);
        }

        async function InitView3D() {
            let view3D = await LoadCesium3D(null);

            fileURL = "uploads/sheffield/geo-images.json";

            await LoadCesiumGeoJSON(view3D, fileURL);
        }

    </script>

    <script>

        InitView3D();



    </script>
</body>